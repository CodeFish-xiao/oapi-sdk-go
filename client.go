//  code generated by oapi sdk gen
package client

import (
	"context"
	"encoding/base64"
	"fmt"
	"net/http"
	"time"

	"github.com/larksuite/oapi-sdk-go/core"
	"github.com/larksuite/oapi-sdk-go/httpclient"
	"github.com/larksuite/oapi-sdk-go/service/acs/v1"
	"github.com/larksuite/oapi-sdk-go/service/admin/v1"
	"github.com/larksuite/oapi-sdk-go/service/application/v6"
	"github.com/larksuite/oapi-sdk-go/service/approval/v4"
	"github.com/larksuite/oapi-sdk-go/service/attendance/v1"
	"github.com/larksuite/oapi-sdk-go/service/baike/v1"
	"github.com/larksuite/oapi-sdk-go/service/bitable/v1"
	"github.com/larksuite/oapi-sdk-go/service/calendar/v4"
	"github.com/larksuite/oapi-sdk-go/service/contact/v3"
	"github.com/larksuite/oapi-sdk-go/service/docx/v1"
	"github.com/larksuite/oapi-sdk-go/service/drive/v1"
	"github.com/larksuite/oapi-sdk-go/service/ehr/v1"
	"github.com/larksuite/oapi-sdk-go/service/event/v1"
	"github.com/larksuite/oapi-sdk-go/service/gray_test_open_sg/v1"
	"github.com/larksuite/oapi-sdk-go/service/human_authentication/v1"
	"github.com/larksuite/oapi-sdk-go/service/im/v1"
	"github.com/larksuite/oapi-sdk-go/service/mail/v1"
	"github.com/larksuite/oapi-sdk-go/service/optical_char_recognition/v1"
	"github.com/larksuite/oapi-sdk-go/service/passport/v1"
	"github.com/larksuite/oapi-sdk-go/service/search/v2"
	"github.com/larksuite/oapi-sdk-go/service/sheets/v3"
	"github.com/larksuite/oapi-sdk-go/service/speech_to_text/v1"
	"github.com/larksuite/oapi-sdk-go/service/task/v1"
	"github.com/larksuite/oapi-sdk-go/service/tenant/v2"
	"github.com/larksuite/oapi-sdk-go/service/translation/v1"
	"github.com/larksuite/oapi-sdk-go/service/vc/v1"
	"github.com/larksuite/oapi-sdk-go/service/wiki/v2"
)

type Client struct {
	config                 *core.Config
	Acs                    *larkacs.AcsService
	Admin                  *larkadmin.AdminService
	Application            *larkapplication.ApplicationService
	Approval               *larkapproval.ApprovalService
	Attendance             *larkattendance.AttendanceService
	Baike                  *larkbaike.BaikeService
	Bitable                *larkbitable.BitableService
	Calendar               *larkcalendar.CalendarService
	Contact                *larkcontact.ContactService
	Docx                   *larkdocx.DocxService
	Drive                  *larkdrive.DriveService
	Ehr                    *larkehr.EhrService
	Event                  *larkevent.EventService
	GrayTestOpenSg         *larkgray_test_open_sg.GrayTestOpenSgService
	HumanAuthentication    *larkhuman_authentication.HumanAuthenticationService
	Im                     *larkim.ImService
	Mail                   *larkmail.MailService
	OpticalCharRecognition *larkoptical_char_recognition.OpticalCharRecognitionService
	Passport               *larkpassport.PassportService
	Search                 *larksearch.SearchService
	Sheets                 *larksheets.SheetsService
	SpeechToText           *larkspeech_to_text.SpeechToTextService
	Task                   *larktask.TaskService
	Tenant                 *larktenant.TenantService
	Translation            *larktranslation.TranslationService
	Vc                     *larkvc.VcService
	Wiki                   *larkwiki.WikiService
}

type ClientOptionFunc func(config *core.Config)

func WithAppType(appType core.AppType) ClientOptionFunc {
	return func(config *core.Config) {
		config.AppType = appType
	}
}

func WithDisableTokenCache() ClientOptionFunc {
	return func(config *core.Config) {
		config.EnableTokenCache = false
	}
}

func WithLogger(logger core.Logger) ClientOptionFunc {
	return func(config *core.Config) {
		config.Logger = logger
	}
}

func WithDomain(domain string) ClientOptionFunc {
	return func(config *core.Config) {
		config.Domain = domain
	}
}

func WithLogLevel(logLevel core.LogLevel) ClientOptionFunc {
	return func(config *core.Config) {
		config.LogLevel = logLevel
	}
}

func WithTokenCache(cache core.Cache) ClientOptionFunc {
	return func(config *core.Config) {
		config.TokenCache = cache
	}
}

func WithLogReqRespInfoAtDebugLevel(printReqRespLog bool) ClientOptionFunc {
	return func(config *core.Config) {
		config.LogReqRespInfoAtDebugLevel = printReqRespLog
	}
}

func WithHelpdeskCredential(helpdeskID, helpdeskToken string) ClientOptionFunc {
	return func(config *core.Config) {
		config.HelpDeskId = helpdeskID
		config.HelpDeskToken = helpdeskToken
		if helpdeskID != "" && helpdeskToken != "" {
			config.HelpdeskAuthToken = base64.StdEncoding.EncodeToString([]byte(fmt.Sprintf("%s:%s", helpdeskID, helpdeskToken)))
		}
	}
}

func WithReqTimeout(reqTimeout time.Duration) ClientOptionFunc {
	return func(config *core.Config) {
		config.ReqTimeout = reqTimeout
	}
}

func NewClient(appId, appSecret string, options ...ClientOptionFunc) *Client {
	// 构建配置
	config := &core.Config{
		Domain:           FeishuDomain,
		AppId:            appId,
		AppSecret:        appSecret,
		EnableTokenCache: true,
		AppType:          core.AppTypeSelfBuilt,
	}
	for _, option := range options {
		option(config)
	}

	// 构建日志器
	core.NewLogger(config)

	// 构建缓存
	core.NewCache(config)

	// 创建httpclient
	httpClient := httpclient.NewHttpClient(config)

	// 创建sdk-client，并初始化服务
	client := &Client{config: config}
	initService(client, httpClient, config)
	return client
}

func initService(client *Client, httpClient *http.Client, config *core.Config) {
	client.Acs = larkacs.NewService(httpClient, config)
	client.Admin = larkadmin.NewService(httpClient, config)
	client.Application = larkapplication.NewService(httpClient, config)
	client.Approval = larkapproval.NewService(httpClient, config)
	client.Attendance = larkattendance.NewService(httpClient, config)
	client.Baike = larkbaike.NewService(httpClient, config)
	client.Bitable = larkbitable.NewService(httpClient, config)
	client.Calendar = larkcalendar.NewService(httpClient, config)
	client.Contact = larkcontact.NewService(httpClient, config)
	client.Docx = larkdocx.NewService(httpClient, config)
	client.Drive = larkdrive.NewService(httpClient, config)
	client.Ehr = larkehr.NewService(httpClient, config)
	client.Event = larkevent.NewService(httpClient, config)
	client.GrayTestOpenSg = larkgray_test_open_sg.NewService(httpClient, config)
	client.HumanAuthentication = larkhuman_authentication.NewService(httpClient, config)
	client.Im = larkim.NewService(httpClient, config)
	client.Mail = larkmail.NewService(httpClient, config)
	client.OpticalCharRecognition = larkoptical_char_recognition.NewService(httpClient, config)
	client.Passport = larkpassport.NewService(httpClient, config)
	client.Search = larksearch.NewService(httpClient, config)
	client.Sheets = larksheets.NewService(httpClient, config)
	client.SpeechToText = larkspeech_to_text.NewService(httpClient, config)
	client.Task = larktask.NewService(httpClient, config)
	client.Tenant = larktenant.NewService(httpClient, config)
	client.Translation = larktranslation.NewService(httpClient, config)
	client.Vc = larkvc.NewService(httpClient, config)
	client.Wiki = larkwiki.NewService(httpClient, config)

}

func (cli *Client) Post(ctx context.Context, httpPath string, body interface{}, accessTokeType core.AccessTokenType, options ...core.RequestOptionFunc) (*core.RawResponse, error) {
	return core.SendRequest(ctx, cli.config, http.MethodPost, httpPath, []core.AccessTokenType{accessTokeType}, body, options...)
}

func (cli *Client) Get(ctx context.Context, httpPath string, body interface{}, accessTokeType core.AccessTokenType, options ...core.RequestOptionFunc) (*core.RawResponse, error) {
	return core.SendRequest(ctx, cli.config, http.MethodGet, httpPath, []core.AccessTokenType{accessTokeType}, body, options...)
}

func (cli *Client) Delete(ctx context.Context, httpPath string, body interface{}, accessTokeType core.AccessTokenType, options ...core.RequestOptionFunc) (*core.RawResponse, error) {
	return core.SendRequest(ctx, cli.config, http.MethodDelete, httpPath, []core.AccessTokenType{accessTokeType}, body, options...)
}

func (cli *Client) Put(ctx context.Context, httpPath string, body interface{}, accessTokeType core.AccessTokenType, options ...core.RequestOptionFunc) (*core.RawResponse, error) {
	return core.SendRequest(ctx, cli.config, http.MethodPut, httpPath, []core.AccessTokenType{accessTokeType}, body, options...)
}

func (cli *Client) Patch(ctx context.Context, httpPath string, body interface{}, accessTokeType core.AccessTokenType, options ...core.RequestOptionFunc) (*core.RawResponse, error) {
	return core.SendRequest(ctx, cli.config, http.MethodPatch, httpPath, []core.AccessTokenType{accessTokeType}, body, options...)
}

func (cli *Client) Head(ctx context.Context, httpPath string, body interface{}, accessTokeType core.AccessTokenType, options ...core.RequestOptionFunc) (*core.RawResponse, error) {
	return core.SendRequest(ctx, cli.config, http.MethodHead, httpPath, []core.AccessTokenType{accessTokeType}, body, options...)
}

func (cli *Client) Options(ctx context.Context, httpPath string, body interface{}, accessTokeType core.AccessTokenType, options ...core.RequestOptionFunc) (*core.RawResponse, error) {
	return core.SendRequest(ctx, cli.config, http.MethodOptions, httpPath, []core.AccessTokenType{accessTokeType}, body, options...)
}

func (cli *Client) Trace(ctx context.Context, httpPath string, body interface{}, accessTokeType core.AccessTokenType, options ...core.RequestOptionFunc) (*core.RawResponse, error) {
	return core.SendRequest(ctx, cli.config, http.MethodTrace, httpPath, []core.AccessTokenType{accessTokeType}, body, options...)
}

var FeishuDomain = "https://open.feishu.cn"
var LarkDomain = "https://open.larksuite.com"
